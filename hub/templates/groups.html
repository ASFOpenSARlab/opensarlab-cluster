{% extends "page.html" %}
{% if announcement_login %}
  {% set announcement = announcement_login %}
{% endif %}

{% block login_widget %}
{% endblock %}

{% block main %}

<style>

    #groups-main {
    }

    #groups-main thead th, tfoot th {
      font-family: 'Rock Salt', cursive;
    }

    #groups-main th {
      letter-spacing: 2px;
      padding: 10px;
    }

    #groups-main td {
      letter-spacing: 1px;
      padding: 10px;
    }

    #groups-main tbody td {
      text-align: center;
    }

    #groups-main tfoot th {
      text-align: right;
    }
</style>


<div id="groups-main" class="container">
    <table id="users_groups">
        <thead>
            <tr>
                <th>Username</th>
                {% for group in groups %}
                <th> {{ group.name }} </th>
                {% endfor %}
                <th> <input id="add_group_box" type='text' size='20' placeholder='New Group Name'/> </th>
            </tr>
        </thead>
        <tbody>
           {% for user in all_users %}
           <tr>
                   <td> {{ user.name }} </td>
                   {% for group in groups %}
                       <td>
                       {% if user.name in group.members %}
                       <input class="group_checkbox" type="checkbox" data-user="{{ user.name }}" data-group="{{ group.name }}" checked />
                       {% else %}
                       <input class="group_checkbox" type="checkbox" data-user="{{ user.name }}" data-group="{{ group.name }}" />
                       {% endif %}
                       </td>
                   {% endfor %}
           </tr>
           {% endfor %}
        </tbody>
    </table>
</div>

<script>
    $('.group_checkbox').change(function() {
        console.log("User '" + this.dataset.user + "' has been updated for group '" + this.dataset.group + "'");
        this_data = {"checked": {"user": this.dataset.user, "group": this.dataset.group, "change_to_checked": this.checked}}
        var jqxhr = $.post( "/hub/groups", this_data, function(result) {
              console.log("Success is " + result);
            })
            .fail(function(result) {
              console.log("Error: " + result)
            })
    });

    $('#add_group_box').on('keydown', function(e) {
        if (e.keyCode == 13) {
            group_name = $(this).val();
            console.log("Group '" + group_name + "' is being added to table" )
            this_data = {'add_group': {'group_name': group_name}}
            var jqxhr = $.post( "/hub/groups", this_data, function(result) {
                  console.log("Success is " + result);
                })
                .fail(function(result) {
                  console.log("Error: " + result)
                })
        }
    });
</script>


{% endblock %}

{% block script %}
{{ super() }}

{% endblock %}
